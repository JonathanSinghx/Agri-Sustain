
@* @using Agrisustain_Jamaica.Models.WeatherForecastDataModels; *@
@model Agrisustain_Jamaica.Models.WeatherForecastDataModels.WeatherTriggerModel;

@{
    ViewData["Title"] = "Create Trigger";
}

<section>
    <div class="position-relative triggerForm-container flex-container">
        <div class="text-center trigger-header">
            <h1>Weather Notifications and Updates</h1>
            <p class="mx-auto">You can create a new weather trigger to receive weather updates and notifications on your personalized weather dashboard. </p>
        </div>
        <div class="row flex-column flex-lg-row">
            <div class="col img-container">
                <img src="~/weatherImg.png" alt="weather" />
            </div>
            <div class="[ col position-relative mt-5 p-5 mt-lg-0 ] [ form-container ]">
                <form method="post" asp-action="CreateWeatherTrigger" id="trigger-form">
                    <div class="d-flex gap-3 mb-3">
                        <label for="name"> Name</label>
                        <input class="w-100" type="text" id="name" placeholder="Enter trigger name" asp-for="TriggerName" />
                    </div>

                   
                    @*  <label for="location">Location</label>
                    <input type="text" id="location" placeholder="Enter location" /> *@
                    <div class="mb-3 trigger-condition">
                        <p class="fw-bold">Trigger condition:</p>
                        <div class="d-flex justify-content-between gap-3 flex-container">
                            <div class="mb-3 col-left">
                                <div class="d-flex flex-column mb-3">
                                    <label>Weather</label>
                                    <select asp-for="WeatherCondition" data-name="weatherCondition">
                                        <option>rainfall</option>
                                        <option>air temperature</option>
                                        <option>wind speed</option>
                                    </select>
                                </div>
                                <div class="d-flex flex-column mb-3">
                                    <label for="level">Level</label>
                                    <input type="number" id="level" value="0" asp-for="ConditionLevel" data-name="level"/>
                                </div>
                            </div>
                            <div class="col-right">
                                <div class="d-flex flex-column mb-3">
                                    <label for="condition">Condition</label>
                                    <select asp-for="Condition" data-name="greater-or-less-than">
                                        <option>&gt; greater than level</option>
                                        <option>&lt; less than level</option>
                                    </select>
                                </div>
                                <div class="d-flex flex-column mb-3">
                                    <label for="units">Units</label>
                                    <select asp-for="Units" data-name="units">
                                        <option value="°C, m/s">°C, m/s</option>
                                        <option value="°F, mph">°F, mph</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="text-content">
                            <span id="static-text">You will be notified if </span>
                            <span id="weatherVal">rainfall</span>
                            <span id="conditionVal">exceeds</span>
                            <span id="levelVal">0</span>
                            <span id="unitVal">°C, m/s</span>
                        </div>
                        
                       @*  <p>You will be notified if the <span>rainfall</span> exceeds <span id="level-val">0</span> <span id="unit-val">celcius, m/s</span></p> *@
                        <div class="notification-details">
                            <p class="fw-bold">Notification details:</p>
                            <div class="flex-container">
                                <select asp-for="Duration" data-name="duration">
                                    <option>1</option>
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                    <option>5</option>
                                </select>
                                <span> day(s) before an event starts </span>
                                <p class="mt-3">You will be notified if the event occurs in <span id="durationVal">1</span> days or earlier</p>
                            </div>
                        </div>
                        </div>
                    <button class="btn" type="submit">Submit</button>
                </form>
            </div>
        </div>
    </div>
    <div class="form-submit-modal"></div>
</section>

@section Scripts {
    <script>
        $(document).ready(function () {
            $("#trigger-form").submit(function (event) {
                event.preventDefault(); // Prevent the default form submission
                $.ajax({
                    url: "/WeatherForecast/CreateWeatherTrigger",
                    type: "POST",
                    data: $(this).serialize(), // Serialize form data
                    success: function (response) {
                        console.log(response);
                        // On success, populate the modal with the received data
                        $(".form-submit-modal").html(response);
                        $('.modal').modal('show'); // Show the modal
                    },
                    error: function (error) {
                        console.error('Error:', error);
                    }
                });
            });
        });
    </script>
}
   @*  <script>
        $(document).ready(function () {
            $("#level").focus(function () {
                // Make an AJAX call when the #level input changes
                $.ajax({
                    // Your AJAX settings go here
                    url: "/WeatherForecast/CreateWeatherTrigger",
                    type: "GET",
                    success: function (response) {
                        console.log("test");
                        $("#level-val").text($("#level").val());
                        //$("#level-val").text($("#level").val()); // Use .text() to set the text content
                    },
                    error: function (error) {
                        console.error('Error:', error);
                    }
                });
            });
        });
    </script> *@

